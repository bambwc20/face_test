<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <img class="thumb_img" width="50%" />
    </div>
    <div class="preview">
      <p>No files currently selected for upload</p>
    </div>
    <select>
      <option selected>성별을 선택해주세요!</option>
      <option value="Man">남자</option>
      <option value="Women">여자</option>
    </select>
    <div>
      <label for="image_uploads">Choose images to upload (PNG, JPG)</label>
      <input
        type="file"
        id="image_uploads"
        name="image_uploads"
        accept=".jpg, .jpeg, .png"
        on
      />
    </div>
    <div>
      <button onclick="summitFile()">Submit</button>
    </div>
  </body>
</html>
<script>
  const elImage = document.querySelector("#image_uploads");
  elImage.style.opacity = 0;
  elImage.addEventListener("change", updateImageDisplay);

  // elImage.addEventListener("ended", () => {
  //   console.log("a");
  //   const elImage = document.querySelector("#image_uploads");
  //   const preview = document.querySelector(".preview");
  //   const Img_pre = document.querySelector(".thumb_img");
  //   const curFiles = elImage.files;
  //   if (curFiles.length === 0) {
  //     const para = document.createElement("p");
  //     para.textContent = "No files currently selected for upload";
  //     preview.appendChild(para);
  //     Img_pre.src = "";
  //   } else {
  //     return;
  //   }
  // });

  function validImageType(image) {
    const result =
      ["image/jpeg", "image/png", "image/jpg"].indexOf(image.type) > -1;
    return result;
  }

  function updateImageDisplay(e) {
    const elImage = document.querySelector("#image_uploads");
    const preview = document.querySelector(".preview");
    const image = e.target.files[0];
    const curFiles = elImage.files;

    if (!validImageType(image)) {
      console.warn("invalide image file type");
      alert("image/png, image/jpg 의 파일타입만 업로드 하세요!");
      return;
    }
    while (preview.firstChild) {
      preview.removeChild(preview.firstChild);
    }

    if (curFiles.length === 0) {
      const para = document.createElement("p");
      para.textContent = "No files currently selected for upload";
      preview.appendChild(para);
    } else {
      const Img_pre = document.querySelector(".thumb_img");
      Img_pre.src = window.URL.createObjectURL(image);
    }
  }

  function summitFile() {
    const elImage = document.querySelector("#image_uploads");
    const preview = document.querySelector(".preview");
    const curFiles = elImage.files;
    const sex = document.querySelector("select");
    if (curFiles.length === 0) {
      alert("파일을 업로드 시켜주세요!");
      return;
    }
    if (sex.value === "Man" || sex.value === "Women") {
      faceAI();
    } else {
      alert("성별을 선택해 주세요!");
      return;
    }
  }

  function faceAI() {
    const sex = document.querySelector("select");
    if (sex.value === "Man") {
      console.log("남자 코드 실행");
    } else if (sex.value === "Women") {
      console.log("여자 코드 실행");
    }
  }
</script>
